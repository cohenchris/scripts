#!/usr/bin/env bash

# How many files to extract?
num_extractions=$#

# Keep track of which extraction is being performed
num_extraction=0

for file in "$@"; do
  file_displayname=$(basename "${file}")
  (( num_extraction++ ))
  notify NORMAL "Attempting to extract ${file_displayname}" "Extraction ${num_extraction}/${num_extractions}"
  if [ -f "${file}" ] ; then
    case "${file}" in
      *.tar.bz2)
        tar xvjf "${file}"
      ;;

      *.tar.gz)
        tar xvzf "${file}"
      ;;

      *.tar.xz)
        tar xf "${file}"
      ;;

      *.bz2)
        bunzip2 "${file}"
      ;;

      *.rar)
        unrar x "${file}"
      ;;

      *.gz)
        gunzip "${file}"
      ;;

      *.tar)
        tar xvf "${file}"
      ;;

      *.tbz2)
        tar xvjf "${file}"
      ;;

      *.tgz)
        tar xvzf "${file}"
      ;;

      *.zip)
        unzip "${file}"
      ;;

      *.Z)
        uncompress "${file}"
      ;;

      *.7z)
        7z x "${file}"
      ;;

      *.zst)
        zstd -d "${file}"
      ;;

      *.jar)
        jar xvf "${file}"
      ;;

      *.xz)
        xz --decompress "${file}"
      ;;

      *)
        notify CRITICAL "ERROR" "No rule to extract '${file_displayname}', stopping extraction..."
        exit 1
      ;;

    esac
  else
    notify CRITICAL "ERROR" "'${file_displayname}' is not a file, stopping extraction..."
    exit 1
  fi
done

notify GOOD "Success!" "Extraction of ${num_extractions} archives completed"
